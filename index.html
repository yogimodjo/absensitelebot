<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>Absensi Karyawan</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <div id="app">
      <header>
        <h1>ğŸ“ Absensi Karyawan Harian Rethapirnt</h1>
        <p id="welcome">Silakan lakukan absensi Anda.</p>
      </header>

      <main>
        <button id="checkin">âœ… Absen Masuk</button>
        <button id="checkout">â° Absen Pulang</button>
      </main>

      <footer>
        <small>PT. Retha Gemilang Lestari Â© 2025</small>
      </footer>
    </div>

    <script>
      // Telegram WebApp API
      const tg = window.Telegram.WebApp;
      tg.ready();
      tg.expand();

      // Ambil data user dari Telegram
      const user = tg.initDataUnsafe.user;
      if (user) {
        document.getElementById("welcome").innerText = `Halo, ${user.first_name || user.username}!`;
      }

      // Tombol Absen
      const sendAbsensi = (type) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((pos) => {
            const data = {
              user: {
                id: user.id,
                username: user.username,
              },
              type: type,
              lat: pos.coords.latitude,
              lon: pos.coords.longitude,
            };

            // Kirim ke backend / n8n Webhook
            fetch("https://n8n.proxmoxsgr.my.id/webhook-test/256af2db-3cda-44db-8b28-b610f2a62da3", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            })
              .then((res) => res.json())
              .then((result) => {
                tg.showAlert(result.message || "âœ… Absensi terkirim!");
              })
              .catch(() => tg.showAlert("âŒ Gagal mengirim absensi"));
          });
        } else {
          tg.showAlert("âŒ Lokasi tidak tersedia di perangkat ini.");
        }
      };

      document.getElementById("checkin").addEventListener("click", () => sendAbsensi("checkin"));
      document.getElementById("checkout").addEventListener("click", () => sendAbsensi("checkout"));
    </script>
  </body>
</html>





