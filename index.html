<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Absensi</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <h2>Absensi Lokasi</h2>
    <button id="btn">ğŸ“ Absen Sekarang</button>
    <p id="status"></p>

    <script>
      const tg = window.Telegram.WebApp;
      const btn = document.getElementById("btn");
      const status = document.getElementById("status");

      btn.onclick = () => {
        navigator.geolocation.getCurrentPosition((pos) => {
          const payload = {
            user: tg.initDataUnsafe.user, // data user dari Telegram
            lat: pos.coords.latitude,
            lon: pos.coords.longitude,
          };

          fetch("https://n8n.proxmoxsgr.my.id/webhook/e92547a4-b8cd-4de0-bac5-8d895599706f/webhook", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((r) => r.json())
            .then((data) => (status.innerText = data.message))
            .catch((err) => (status.innerText = "Error: " + err));
        });
      };

      tg.expand();
    </script>
  </body>
</html>
